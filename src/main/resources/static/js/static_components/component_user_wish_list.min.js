var templateDiv=$("#choose1");var uid=userInfo.uid;var list;var thisUser;$(document).ready(function(){function b(){$.ajax({url:"/person/getUserById?uid=".concat(uid),type:"get",async:false,success:function(c){console.log(c);thisUser=c.resultMap.user;list=c.resultMap.wishList;$(".wish-list-owner").text(thisUser.ualias+"的心愿单")}})}function a(){if(list==null||list.status==0){$(".count").text("0");return}$(".count").text(list.length);var e="";for(var d=0;d<list.length;d++){var f=list[d];var c=(parseFloat(f.gprice)*(parseFloat(f.discount))).toString();if(c.length>6){c.substr(0,6)}var g=f.gtype;g=g.substring(1,g.length-1);g=g.split(",");e+="<div class=wish-list-block><span class=image-wrapper><img src="+f.chref+"></span><a class=title href=game_detail.html?gid="+f.gid+">"+f.gname+"</a><div class=shopping-operator><ul>";if(new Date(f.realeasedate)<new Date()){e+="<li><button id="+f.gid+"-1 class=button1>加入购物车</button></li>"}e+="<li><button id="+f.gid+"-2 class=button2>移出心愿单</button></li></ul></div><div class=sale-price><span>￥"+c+"</span></div></div>"}$(".wish-list-content").html(e)}$(".close").click(function(){console.log("click 1");templateDiv.removeClass("active");templateDiv.addClass("close");$(this).removeClass("close");$(this).addClass("active");templateDiv=$(this)});$(document).on("click",".close",function(){templateDiv.removeClass("active");templateDiv.addClass("close");$(this).removeClass("close");$(this).addClass("active");templateDiv=$(this)});$("#choose1").removeClass("close");$("#choose1").addClass("active");b();a()});function reload(){location.reload()}$(document).on("click",".button1",function(){console.log("click 1");var d;var a=$(this).attr("id");a=a.substring(0,a.length-2);console.log(a);for(var b=0;b<list.length;b++){if(list[b].gid==a){d=list[b]}}var c={gid:d.gid,discount:d.discount,price:d.gprice,gname:d.gname,chref:d.chref};$("#choose1").removeClass("close");$("#choose1").addClass("active");console.log(c);addCar(c)});function addCar(e){console.log(e.gid);var a=[],c=0;if(localStorage.getItem("shoppingcar")==null||(JSON.parse(localStorage.getItem("shoppingcar")))[0]==null){}else{c=1;console.log("购物车存在");a=JSON.parse(localStorage.getItem("shoppingcar"));var b=0,d=a.length;for(;b<d;b++){if(JSON.parse(a[b]==null)){delete a[b]}else{if(parseInt(e.gid)==a[b].gid){c=2;console.log("购物车存在，商品在购物车中");myAlert("已加入购物车，请勿重复添加！");break}}}}if(c==0||c==1){a.push(e);localStorage.setItem("shoppingcar",JSON.stringify(a));myAlert("加入购物车成功！")}}$(document).on("click",".button2",function(){console.log("click 2");var a=$(this).attr("id");a.substring(0,a.length-2);console.log(a);let submitData=new FormData();submitData.append("uid",thisUser.uid);submitData.append("gid",parseInt(a));submitData.append("mode",0);JSON.stringify(submitData);$.ajax({url:"/person/updateWishListById",type:"post",data:submitData,processData:false,contentType:false,cache:false,async:false,success:function(b){console.dir(b);myAlert("删除成功")}});location.reload()});$(".close").click(function(){templateDiv.removeClass("active");templateDiv.addClass("close");$(this).removeClass("close");$(this).addClass("active");templateDiv=$(this)});