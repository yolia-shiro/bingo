$(document).ready(function(){formData=searchCondition;let sort;let order="desc";let pageIndex=0;let price_sort=0;let category=[];let tag=[];let minPrice;let maxPrice;let area;let language;function b(){console.log("查询条件：",formData);console.log("issearchResult",isSearchResult);if(isSearchResult===true){$.post(requestmap.store_search,searchCondition,function(c){console.log("gameList:",c);let gamel=c.resultMap.searchList;let html="";$("#game-list").empty();if(c.status===0){return}for(let i=0;i<gamel.length;i++){let game=gamel[i]let temp=(parseFloat(game.gprice)*(parseFloat(game.discount))).toString();if(temp.length>6){temp.substr(0,6)}let typelist=game.gtype;typelist=(typelist!=null?typelist.substring(1,typelist.length-1):"");typelist=typelist.split(",");let languagelist=game.language;languagelist=(languagelist!=null?languagelist.substring(1,languagelist.length-1):"");languagelist=languagelist.split(",");for(let j=0;j<languagelist.length;j++){languagelist[j].substring(1,languagelist[j].length-1)}html+="<li><a href=/game_detail.html?gid="+game.gid+" class=game-click target=_black><div class=left><img src="+game.chref+"></div><div class=right>";if(game.discount!=1&&game.discount!=null){html+="<span class=game-discount>-"+((1-game.discount)*100).toFixed()+"%</span><span class=game-origin-price>￥"+game.gprice+"</span>"}html+="<span class=game-sale-price>￥"+temp+"</span></div><div class=middle><p class=title>"+game.gname;if(game.discount!=1){html+="<span class=title-tag>促销</span>"}var d=false;for(var e=0;e<languagelist.length;e++){if(languagelist[e]==='"中文"'&&languagelist.length==1){html+="<span class=title-area>中国站</span>";d=true;break}}if(!d){html+="<span class=title-area>国际站</span>"}html+="</p><p class='date'>发行于"+(game.realeasedate!=null?game.realeasedate.substring(0,10):" ")+"</p><p class='tags'>";for(j=0;j<typelist.length;j++){html+="<span class=tag-block>"+(typelist[j]!=null?typelist[j].substring(1,typelist[j].length-1):" ")+"</span>"}html+="</p></div></a></li>"}$("#game-list").html(html)});isSearchResult=false}else{$.post(requestmap.store_search,formData,function(c){let gamel=c.resultMap.searchList;let page=c.resultMap.allSearchNum;let html="";$("#game-list").empty();if(c.status===0){return}for(let i=0;i<gamel.length;i++){let game=gamel[i]let temp=(parseFloat(game.gprice)*(parseFloat(game.discount))).toString();if(temp.length>6){temp.substr(0,6)}let typelist=game.gtype;typelist=(typelist!=null?typelist.substring(1,typelist.length-1):"");typelist=typelist.split(",");let languagelist=game.language;languagelist=(languagelist!=null?languagelist.substring(1,languagelist.length-1):"");languagelist=languagelist.split(",");for(let j=0;j<languagelist.length;j++){languagelist[j].substring(1,languagelist[j].length-1)}html+="<li><a href=/game_detail.html?gid="+game.gid+" class=game-click target='_blank'><div class=left><img src="+game.chref+"></div><div class=right>";if(game.discount!=1&&game.discount!=null){html+="<span class=game-discount>-"+((1-game.discount)*100).toFixed()+"%</span><span class=game-origin-price>￥"+game.gprice+"</span>"}html+="<span class=game-sale-price>￥"+temp+"</span></div><div class=middle><p class=title>"+game.gname;if(game.discount!=1){html+="<span class=title-tag>促销</span>"}var d=false;for(var e=0;e<languagelist.length;e++){if(languagelist[e]==='"中文"'&&languagelist.length==1){html+="<span class=title-area>中国站</span>";d=true;break}}if(!d){html+="<span class=title-area>国际站</span>"}html+="</p><p class='date'>发行于"+(game.realeasedate!=null?game.realeasedate.substring(0,10):" ")+"</p><p class='tags'>";for(j=0;j<typelist.length;j++){html+="<span class=tag-block>"+(typelist[j]!=null?typelist[j].substring(1,typelist[j].length-1):" ")+"</span>"}html+="</p></div></a></li>"}$("#game-list").html(html);a(page)})}}function a(c){var e="";if(c===0){$(".pagination").html("");return}for(var d=0;d<c;d++){if(d===parseInt(pageIndex/10)){e+='<button class="page-item active-button">'+parseInt(d+1).toString()+"</button>"}else{e+='<button class="page-item">'+parseInt(d+1).toString()+"</button>"}}$(".page-list").empty();$(".page-list").html(e)}$(document).on("click",".page-item",function(){console.log($(this).text());pageIndex=(parseInt($(this).text())-1)*10;console.log("pageIndex is "+pageIndex);let thisFormData={sort:sort,pageIndex:pageIndex,order:order,category:JSON.stringify(category),tag:JSON.stringify(tag),minPrice:minPrice,maxPrice:maxPrice,area:area,language:language}JSON.stringify(thisFormData);formData=thisFormData;b();$(".active-button").removeClass("active-button");$(this).addClass("active-button")});$(document).on("click",".game-sort-order",function(){pageIndex=0;if(this.innerText==="全部"){sort=""}else{if(this.innerText==="折扣"){sort="discount"}else{if(this.innerText==="最新"){sort="new"}else{if(this.innerText==="评分"){sort="score"}else{sort="price"}}}}if(sort==="price"){if(price_sort==0){price_sort=1}else{price_sort=0}if(price_sort==1){order="desc";$(".fa").text("▲")}else{order="asc";$(".fa").text("▼")}console.log("价格的排序方法是"+price_sort);let thisFormData={sort:sort,pageIndex:pageIndex,order:order,category:JSON.stringify(category),tag:JSON.stringify(tag),minPrice:minPrice,maxPrice:maxPrice,area:area,language:language}JSON.stringify(thisFormData);formData=thisFormData;b()}else{let thisFormData={sort:sort,pageIndex:pageIndex,order:order,category:JSON.stringify(category),tag:JSON.stringify(tag),minPrice:minPrice,maxPrice:maxPrice,area:area,language:language}JSON.stringify(thisFormData);formData=thisFormData;b()}$(".condition .active").removeClass("active");$(this).addClass("active")});$(document).on("click",".tags-block-wrapper",function(){pageIndex=0;var c=$(this).text();var e=c[0];if(e=="√"){var d=c;$(this).text((d!=null?d.substring(1,d.length):""));category.splice($.inArray($(this).text(),category),1);console.log("category= "+$(this).text())}else{category.push(c);c="√"+c;$(this).text(c)}let thisFormData={sort:sort,pageIndex:pageIndex,order:order,category:JSON.stringify(category),tag:JSON.stringify(tag),minPrice:minPrice,maxPrice:maxPrice,area:area,language:language}JSON.stringify(thisFormData);formData=thisFormData;b()});$(document).on("click",".tags-block-wrapper1",function(){pageIndex=0;var c=$(this).text();var d=c;var f=c[0];if(f=="√"){var e=c;$(this).text((e!=null?e.substring(1,e.length):""));tag.splice($.inArray($(this).text(),tag),1);console.log("tag= "+$(this).text())}else{if(c=="预售游戏"){c="presale"}else{if(c=="新品游戏"){c="newsale"}else{c="promotion"}}tag.push(c);c="√"+d;$(this).text(c)}let thisFormData={sort:sort,pageIndex:pageIndex,order:order,category:JSON.stringify(category),tag:JSON.stringify(tag),minPrice:minPrice,maxPrice:maxPrice,area:area,language:language}formData=thisFormData;b()});$(document).on("click",".tags-block-wrapper2",function(){pageIndex=0;console.log("page is "+pageIndex);var c=$(this).text();if(c[0]!="√"){for(var d=17;d<=20;d++){var e=$("#fa"+d).text();if(e[0]=="√"){$("#fa"+d).text(e.substring(1,e.length))}}$(this).text("√"+c)}else{$(this).text(c.substring(1,c.length))}switch($(this).text()){case"√￥0-10":minPrice=0;maxPrice=10;break;case"√￥11-50":minPrice=11;maxPrice=50;break;case"√￥51-100":minPrice=51;maxPrice=100;break;case"√>=￥101":minPrice=100;maxPrice=10000;break;default:minPrice=null;maxPrice=null;break}let thisFormData={sort:sort,pageIndex:pageIndex,order:order,category:JSON.stringify(category),tag:JSON.stringify(tag),minPrice:minPrice,maxPrice:maxPrice,area:area,language:language}JSON.stringify(thisFormData);formData=thisFormData;b()});$(document).on("click",".tags-block-wrapper4",function(){pageIndex=0;var c=$(this).text();if(c[0]!="√"){for(var d=21;d<=22;d++){var e=$("#fa"+d).text();if(e[0]=="√"){$("#fa"+d).text(e.substr(1,e.length))}}$(this).text("√"+c)}else{$(this).text(c.substring(1,c.length))}switch($(this).text()){case"√中国站":area="China";break;case"√国际站":area="other";break;default:area=null;break}let thisFormData={sort:sort,pageIndex:pageIndex,order:order,category:JSON.stringify(category),tag:JSON.stringify(tag),minPrice:minPrice,maxPrice:maxPrice,area:area,language:language}JSON.stringify(thisFormData);formData=thisFormData;b()});$(document).on("click",".tags-block-wrapper3",function(){pageIndex=0;var c=$(this).text();if(c[0]!="√"){for(var d=15;d<=16;d++){var e=$("#fa"+d).text();if(e[0]=="√"){$("#fa"+d).text(e.substring(1,e.length))}}$(this).text("√"+c)}else{$(this).text(c.substring(1,c.length))}switch($(this).text()){case"√中文":language="Chinese";break;case"√英文":language="other";break;default:language=null;break}let thisFormData={sort:sort,pageIndex:pageIndex,order:order,category:JSON.stringify(category),tag:JSON.stringify(tag),minPrice:minPrice,maxPrice:maxPrice,area:area,language:language}JSON.stringify(thisFormData);formData=thisFormData;b()});b()});