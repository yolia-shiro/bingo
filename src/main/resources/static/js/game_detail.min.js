let game,systemReqlet systemResultlet GAMEIDlet GAMEINFOlet videohreffunction timestampToTime(a){let date=new Date(parseInt(a));let Y=date.getFullYear()+"-";let M=(date.getMonth()+1<10?"0"+(date.getMonth()+1):date.getMonth()+1)+"-";let D=date.getDate()+" ";let h=date.getHours()+":";let m=(date.getMinutes()<10?"0"+(date.getMinutes()):date.getMinutes())+":";let s=(date.getSeconds()<10?"0"+(date.getSeconds()):date.getSeconds());return Y+M+D+h+m+s}function change(a){console.log("点击元素:"+$(a).attr("id"));if($(a).attr("id")==="video"||$(a).attr("id")==="videochild"){document.getElementById("show").innerHTML='<video class="videoPlayer" src='+game.vhref+' id="videoPlayer" controls="controls"  autobuffer muted >\n</video>'}else{document.getElementById("show").innerHTML="<img src="+$(a).attr("src")+" class='default-height' />"}}function star(e,a){var d=9,b,c=5;for(b=e;b>=2;b-=2){a='<svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-star-fill star" fill="currentColor" xmlns="http://www.w3.org/2000/svg">\n<path  d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.283.95l-3.523 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>\n</svg>'+a;c-=1}for(c;c>0;c--){a=a+'<svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-star star" fill="currentColor" xmlns="http://www.w3.org/2000/svg">\n<path fill-rule="evenodd" d="M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.523-3.356c.329-.314.158-.888-.283-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767l-3.686 1.894.694-3.957a.565.565 0 0 0-.163-.505L1.71 6.745l4.052-.576a.525.525 0 0 0 .393-.288l1.847-3.658 1.846 3.658a.525.525 0 0 0 .393.288l4.052.575-2.906 2.77a.564.564 0 0 0-.163.506l.694 3.957-3.686-1.894a.503.503 0 0 0-.461 0z"/>\n</svg>'}return a}function addCar(){if(userInfo.uid===undefined){myAlert("请登录后进行操作!");return}var e={gid:parseInt(GAMEID),discount:game.discount,price:game.gprice,gname:game.gname,chref:game.chref};var a=[],c=0;if(localStorage.getItem("shoppingcar")==null||(JSON.parse(localStorage.getItem("shoppingcar")))[0]==null){}else{c=1;console.log("购物车存在");a=JSON.parse(localStorage.getItem("shoppingcar"));var b=0,d=a.length;for(;b<d;b++){if(JSON.parse(a[b]==null)){delete a[b]}else{if(GAMEID==a[b].gid){c=2;console.log("购物车存在，商品在购物车中");window.alert("已加入购物车，请勿重复添加！");break}}}}if(c==0||c==1){a.push(e);localStorage.setItem("shoppingcar",JSON.stringify(a));window.alert("加入购物车成功！")}}function buy(){if(userInfo.uid===undefined){myAlert("请登录后进行操作!");return}var l,o=1,q;l=window.prompt("输入购买数量(1~10的整数)");if(l===null){return}if(isNaN(q=parseInt(l,10))){window.alert("请输入整数!!!")}else{if(q>10||q<=0||l!=q){window.alert("无效输入,请输入1~10之间的整数!!!");return}else{console.log("购买数量为: "+q);var k=0,c=[];var p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz012345678";for(;k<q;k++){var r="";var f=Math.random()*57;var d=Math.random()*57;var b=Math.random()*57;var a=Math.random()*57;var t=Math.random()*57;r+=p.charAt(f)+p.charAt(d)+p.charAt(b)+p.charAt(a)+p.charAt(t);c.push(r);console.log("生成的key为: "+r)}let oid="";f=Math.random()*57;d=Math.random()*57;b=Math.random()*57;a=Math.random()*57;t=Math.random()*57;let temp6=Math.random()*57;let temp7=Math.random()*57;let temp8=Math.random()*57;let temp9=Math.random()*57;let temp10=Math.random()*57;oid+=p.charAt(f)+p.charAt(d)+p.charAt(b)+p.charAt(a)+p.charAt(t)+p.charAt(temp6)+p.charAt(temp7)+p.charAt(temp8)+p.charAt(temp9)+p.charAt(temp10);console.log("生成的oid为: "+oid);var n=new Date();var g={oid:oid,uid:userInfo.uid,gid:GAMEID,knum:q,klist:JSON.stringify(c),discount:game.discount,otime:n};console.log(g);$.post("store/insertOrderDetail",g,function(i){console.log(i)});var e=[];e.push(parseInt(GAMEID));var j={uid:userInfo.uid,gid:JSON.stringify(e),mode:1};console.log(JSON.stringify(e));$.post("/person/updateGameListById",j,function(i){console.log(i)});window.alert("购买成功！")}}}function addWishList(){if(userInfo.uid===undefined){myAlert("请登录后进行操作!");return}var a={uid:userInfo.uid};$.get("/person/getUserById",a,function(b){console.log(b);wishlist=b.resultMap.wishList;console.log(wishlist);var c=0,d=0;if(wishlist==null){}else{var e=wishlist.length;for(;c<e;c++){console.log(wishlist[c].gid);console.log(GAMEID);if(GAMEID==wishlist[c].gid){d=1;break}}}if(d==1){window.alert("已在心愿单中！请勿重复添加")}else{var f={uid:userInfo.uid,gid:GAMEID,mode:1};$.post("/person/updateWishListById",f,function(g){console.log(g)});window.alert("加入心愿单成功！")}})}$(document).ready(function(){var e=location.href;var d=e.length;var c=e.indexOf("=");GAMEID=decodeURI(e.substr(c+1,d-c));function b(){var g={id:GAMEID};$.get("store/gameDetailShow",g,function(i){game=i.resultMap.game;console.log(i);document.getElementById("title").innerText=game.gname;document.getElementById("detail").innerText=game.detail;document.getElementById("cover").src=game.chref;videohref=game.vhref;console.log(videohref);document.getElementById("show").innerHTML='<video class="videoPlayer" src="'+game.vhref+'" id="videoPlayer"  controls="controls"  autobuffer muted >\n</video>';var k=document.createElement("canvas");video=document.getElementById("videoPlayer");k.width=145;k.height=82;k.getContext("2d").drawImage(video,0,0,k.width,k.height);console.log();document.getElementById("video").src=k.toDataURL("image/png");console.log("图片源: "+k.toDataURL("image/png"));document.getElementById("elem1").src=game.phref;document.getElementById("elem2").src=game.phref;document.getElementById("elem3").src=game.phref;document.getElementById("elem4").src=game.phref;document.getElementById("elem5").src=game.phref;document.getElementById("elem6").src=game.phref;document.getElementById("developer").innerText=game.developer;document.getElementById("publisher").innerText=game.publisher;document.getElementById("realeasedate").innerText=game.realeasedate.substr(0,10);var j=JSON.parse(game.platform);document.getElementById("platform").innerText=j;j=JSON.parse(game.language);document.getElementById("language").innerText=j;j=JSON.parse(game.gtype);document.getElementById("gtype").innerText=j;var p=game.realeasedate;console.log("发行时间:"+p);console.log(typeof game.realeasedate);if(new Date(game.realeasedate).getTime()>new Date().getTime()){$("#discount").text("发售日期："+game.realeasedate);$("#gprice").hide();$("#realPrice").hide();$(".box-buy").hide()}else{console.log("discount",game.discount);if(game.discount!==1){document.getElementById("discount").innerText="-"+((1-game.discount)*100).toFixed()+"%";document.getElementById("gprice").innerText="￥"+game.gprice}else{$(".off-discount").hide();$("#gprice").hide();$(".shoopingcat").css("margin-top","32px")}document.getElementById("realPrice").innerText="￥"+game.discount*game.gprice}systemReq=JSON.parse(game.systemreq);if(game.gscore===null||game.gscore===""){$("#gscore").text("0")}else{$("#gscore").text(game.gscore)}var q=parseInt(game.gscore);var l="";l=star(q,l);$("#gstar").html(l);function o(){if(systemReq===""||systemReq===null){return}var r={id:systemReq[0]};$.get("store/systemReqShow",r,function(t){systemResult=t.resultMap.systemReq;document.getElementById("cpu1").innerText=systemResult.cpu;document.getElementById("gpu1").innerText=systemResult.gpu;document.getElementById("os1").innerText=systemResult.os;document.getElementById("ram1").innerText=systemResult.ram;document.getElementById("harddisk1").innerText=systemResult.harddisk})}function n(){if(systemReq===""||systemReq===null){return}var r={id:systemReq[1]};$.get("store/systemReqShow",r,function(t){systemResult=t.resultMap.systemReq;document.getElementById("cpu2").innerText=systemResult.cpu;document.getElementById("gpu2").innerText=systemResult.gpu;document.getElementById("os2").innerText=systemResult.os;document.getElementById("ram2").innerText=systemResult.ram;document.getElementById("harddisk2").innerText=systemResult.harddisk})}o();n()})}function f(){var g={idType:"gid",idValue:GAMEID};$.get("store/evaluationShow",g,function(q){if(q.resultMap.evaluationList_gid==="查询评测为空"){return}console.log("evaList",q.resultMap.evaluationList_gid);var r=q.resultMap.evaluationList_gid;var l=0,p=0;var k="",o="",n="",j="";$.each(r,function(i,t){$.get("/person/getUserById?uid="+t.uid,function(v){var u=v.resultMap.user;o='<div class="sElem"><div class="score-1-3-1">\n                            <div class="Avatar">\n                                <img class="uAvatar" src='+u.uavatar+'>\n                            </div>\n                            <div class="uname">'+u.ualias+"</div>\n                        </div>";o+='<div class="score-1-3-2">\n                            <div class="score1">\n';n=star(t.score,"");j='\n                            </div>\n                            <div class="score2">发布于<span>'+t.etime.substr(0,19)+'</span></div>\n                            <div class="score3">'+t.content+"</div>\n                        </div></div>";k=o+n+j;var w="#scoreElem"+(i+1);$("#scoreElem").append(k)})})})}function a(){console.log("evaluation userInfo",userInfo);if(userInfo.uid===undefined){return}var g={uid:userInfo.uid};$.get("/person/getUserById",g,function(u){var p=location.href;var r=p.length;var q=p.indexOf("=");var o=decodeURI(p.substr(q+1,r-q));console.log("游戏ID: "+o);gamelist=JSON.parse(u.resultMap.user.gamelist);console.log(gamelist);var n=0,k=gamelist.length,t=0;for(;n<k;n++){console.log("查找到的游戏ID: "+gamelist[n]);if(o==gamelist[n]){t=1;console.log("用户拥有此游戏");break}}if(t==1){var l={gid:o,uid:userInfo.uid};$.get("store/searchEvaluationByUidAndGid",l,function(i){console.log("evaluation result",i);if(i.status==0){console.log("用户暂未评论");$("#addContent").show()}})}})}$("#submit").click(function(){var n=location.href;var k=n.length;var j=n.indexOf("=");var g=decodeURI(n.substr(j+1,k-j));var i=new Date();if($("#content-txt").val()!=""&&$("#content-score").val()!=""){console.log(i);var l={uid:userInfo.uid,gid:g,content:$("#content-txt").val(),score:$("#content-score").val(),etime:timestampToTime(i.getTime())};$.post("store/evaluationAddHandle",l,function(o){console.log(o)});window.location.reload()}});b();f();a()});